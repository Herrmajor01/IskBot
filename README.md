# IskBot - Telegram Bot для расчета процентов по ст. 395 ГК РФ

Telegram бот для автоматического расчета процентов по статье 395 Гражданского кодекса РФ с актуальными ключевыми ставками Центрального банка.

## Функциональность

- Обработка .docx файлов с таблицами расчета процентов
- Автоматическое получение актуальных ключевых ставок ЦБ РФ
- Расчет процентов по ст. 395 ГК РФ до текущей даты
- Генерация результата в формате Word (.docx)

## Установка и запуск

1. Клонируйте репозиторий:
```bash
git clone https://github.com/your-username/IskBot.git
cd IskBot
```

2. Создайте виртуальное окружение и активируйте его:
```bash
python -m venv venv
source venv/bin/activate  # для Linux/Mac
# или
venv\Scripts\activate  # для Windows
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Получите токен бота у [@BotFather](https://t.me/BotFather) в Telegram

5. Создайте файл `.env` и добавьте токен:
```bash
python setup_env.py
```
Затем отредактируйте файл `.env` и замените `your_bot_token_here` на ваш реальный токен.

6. Запустите бота:
```bash
python main.py
```

## Использование

1. Отправьте команду `/start` боту
2. Загрузите .docx файл с таблицей расчета процентов
3. Получите обновленный расчет с актуальными ставками

## Зависимости

- `python-telegram-bot==20.7` - Telegram Bot API
- `python-docx` - Работа с Word документами
- `requests` - HTTP запросы
- `beautifulsoup4` - Парсинг HTML

## Структура проекта

- `main.py` - Основной файл бота
- `calc_395.py` - Логика расчета процентов по ст. 395 ГК РФ
- `cal.py` - Дополнительные функции расчета
- `requirements.txt` - Зависимости проекта

## Устранение неполадок

### Ошибка "TELEGRAM_BOT_TOKEN не указан в .env"
1. Убедитесь, что файл `.env` существует в корне проекта
2. Проверьте, что токен указан правильно: `TELEGRAM_BOT_TOKEN=ваш_токен_здесь`
3. Запустите `python setup_env.py` для создания файла

### Ошибки парсинга файла
1. Убедитесь, что .docx файл содержит таблицу с правильной структурой
2. Таблица должна иметь минимум 7 столбцов: сумма, дата начала, дата окончания, дни, ставка, формула, проценты
3. Даты должны быть в формате ДД.ММ.ГГГГ
4. Числа должны содержать только цифры, точки и запятые

### Ошибка "name 'days' is not defined"
Эта ошибка исправлена в текущей версии. Если она появляется, обновите код.

### Тестирование парсинга
Для проверки парсинга файла используйте тестовый скрипт:
```bash
python test_parsing.py <путь_к_файлу.docx>
```
Это поможет выявить проблемы с форматированием таблицы или текста.

## Лицензия

MIT License
