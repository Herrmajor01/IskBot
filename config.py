"""
Конфигурационный файл для IskBot.
"""

import os
from typing import List, Tuple

# Настройки бота
BOT_CONFIG = {
    'max_file_size_mb': 10,
    'supported_formats': ['.docx'],
    'temp_dir': 'uploads',
    'log_file': 'bot.log',
    'log_level': 'INFO'
}

# Настройки парсинга
PARSING_CONFIG = {
    'max_paragraphs_per_section': 10,
    'date_formats': ['%d.%m.%Y', '%d/%m/%Y', '%Y-%m-%d'],
    'number_formats': {
        'decimal_separator': '.',
        'thousands_separator': ' ',
        'currency_symbols': ['руб', 'рублей', '₽', 'р.']
    }
}

# Настройки расчета
CALCULATION_CONFIG = {
    'rates_url': 'https://395gk.ru/svedcb.htm',
    'cache_file': 'key_rates_cache.json',
    'cache_ttl_hours': 24,
    'fallback_rate': 21.0,
    'request_timeout': 10
}

# База судов (расширенная)
COURTS_DATABASE = {
    'Москва': {
        'name': 'Арбитражный суд города Москвы',
        'address': '115191, г. Москва, ул. Большая Тульская, д. 17'
    },
    'Санкт-Петербург': {
        'name': 'Арбитражный суд города Санкт-Петербурга и Ленинградской области',
        'address': '190000, г. Санкт-Петербург, ул. Марата, д. 72'
    },
    'Адыгея': {
        'name': 'Арбитражный суд Республики Адыгея',
        'address': '385000, г. Майкоп, ул. Краснооктябрьская, д. 21'
    },
    'Алтай': {
        'name': 'Арбитражный суд Республики Алтай',
        'address': '649000, г. Горно-Алтайск, ул. Чорос-Гуркина, д. 38'
    },
    'Башкортостан': {
        'name': 'Арбитражный суд Республики Башкортостан',
        'address': '450008, г. Уфа, ул. Пушкина, д. 86'
    },
    'Бурятия': {
        'name': 'Арбитражный суд Республики Бурятия',
        'address': '670000, г. Улан-Удэ, ул. Ленина, д. 51'
    },
    'Дагестан': {
        'name': 'Арбитражный суд Республики Дагестан',
        'address': '367000, г. Махачкала, ул. Дахадаева, д. 132'
    },
    'Ингушетия': {
        'name': 'Арбитражный суд Республики Ингушетия',
        'address': '386100, г. Магас, ул. А.Х. Мальсагова, д. 1'
    },
    'Кабардино-Балкария': {
        'name': 'Арбитражный суд Кабардино-Балкарской Республики',
        'address': '360000, г. Нальчик, ул. Ленина, д. 33'
    },
    'Калмыкия': {
        'name': 'Арбитражный суд Республики Калмыкия',
        'address': '358000, г. Элиста, ул. Ленина, д. 273'
    },
    'Карачаево-Черкесия': {
        'name': 'Арбитражный суд Карачаево-Черкесской Республики',
        'address': '369000, г. Черкесск, ул. Ленина, д. 14'
    },
    'Карелия': {
        'name': 'Арбитражный суд Республики Карелия',
        'address': '185035, г. Петрозаводск, пр. Ленина, д. 21'
    },
    'Коми': {
        'name': 'Арбитражный суд Республики Коми',
        'address': '167000, г. Сыктывкар, ул. Интернациональная, д. 108'
    },
    'Марий Эл': {
        'name': 'Арбитражный суд Республики Марий Эл',
        'address': '424000, г. Йошкар-Ола, ул. Комсомольская, д. 134'
    },
    'Мордовия': {
        'name': 'Арбитражный суд Республики Мордовия',
        'address': '430000, г. Саранск, ул. Советская, д. 55'
    },
    'Саха': {
        'name': 'Арбитражный суд Республики Саха (Якутия)',
        'address': '677000, г. Якутск, ул. Ленина, д. 24'
    },
    'Северная Осетия': {
        'name': 'Арбитражный суд Республики Северная Осетия - Алания',
        'address': '362000, г. Владикавказ, ул. Ленина, д. 46'
    },
    'Татарстан': {
        'name': 'Арбитражный суд Республики Татарстан',
        'address': '420111, г. Казань, ул. Кремлевская, д. 8'
    },
    'Тыва': {
        'name': 'Арбитражный суд Республики Тыва',
        'address': '667000, г. Кызыл, ул. Ленина, д. 32'
    },
    'Удмуртия': {
        'name': 'Арбитражный суд Удмуртской Республики',
        'address': '426000, г. Ижевск, ул. Ленина, д. 16'
    },
    'Хакасия': {
        'name': 'Арбитражный суд Республики Хакасия',
        'address': '655000, г. Абакан, ул. Щетинкина, д. 18'
    },
    'Чечня': {
        'name': 'Арбитражный суд Чеченской Республики',
        'address': '364000, г. Грозный, ул. Ленина, д. 32'
    },
    'Чувашия': {
        'name': 'Арбитражный суд Чувашской Республики',
        'address': '428000, г. Чебоксары, ул. К. Маркса, д. 38'
    },
    'Алтайский край': {
        'name': 'Арбитражный суд Алтайского края',
        'address': '656000, г. Барнаул, ул. Ползунова, д. 34'
    },
    'Забайкальский край': {
        'name': 'Арбитражный суд Забайкальского края',
        'address': '672000, г. Чита, ул. Амурская, д. 66'
    },
    'Камчатский край': {
        'name': 'Арбитражный суд Камчатского края',
        'address': '683000, г. Петропавловск-Камчатский, ул. Ленинская, д. 58'
    },
    'Краснодарский край': {
        'name': 'Арбитражный суд Краснодарского края',
        'address': '350000, г. Краснодар, ул. Красная, д. 139'
    },
    'Красноярский край': {
        'name': 'Арбитражный суд Красноярского края',
        'address': '660049, г. Красноярск, ул. Ленина, д. 22'
    },
    'Пермский край': {
        'name': 'Арбитражный суд Пермского края',
        'address': '614000, г. Пермь, ул. Ленина, д. 60'
    },
    'Приморский край': {
        'name': 'Арбитражный суд Приморского края',
        'address': '690091, г. Владивосток, ул. Светланская, д. 54'
    },
    'Ставропольский край': {
        'name': 'Арбитражный суд Ставропольского края',
        'address': '355000, г. Ставрополь, ул. Ленина, д. 267'
    },
    'Хабаровский край': {
        'name': 'Арбитражный суд Хабаровского края',
        'address': '680000, г. Хабаровск, ул. Ленина, д. 56'
    },
    'Амурская область': {
        'name': 'Арбитражный суд Амурской области',
        'address': '675000, г. Благовещенск, ул. Ленина, д. 165'
    },
    'Архангельская область': {
        'name': 'Арбитражный суд Архангельской области',
        'address': '163000, г. Архангельск, ул. Логинова, д. 1'
    },
    'Астраханская область': {
        'name': 'Арбитражный суд Астраханской области',
        'address': '414000, г. Астрахань, ул. Тредиаковского, д. 2'
    },
    'Белгородская область': {
        'name': 'Арбитражный суд Белгородской области',
        'address': '308000, г. Белгород, ул. Преображенская, д. 78'
    },
    'Брянская область': {
        'name': 'Арбитражный суд Брянской области',
        'address': '241000, г. Брянск, ул. Фокина, д. 15'
    },
    'Владимирская область': {
        'name': 'Арбитражный суд Владимирской области',
        'address': '600000, г. Владимир, ул. Большая Московская, д. 33'
    },
    'Волгоградская область': {
        'name': 'Арбитражный суд Волгоградской области',
        'address': '400005, г. Волгоград, ул. 7-й Гвардейской, д. 2'
    },
    'Вологодская область': {
        'name': 'Арбитражный суд Вологодской области',
        'address': '160000, г. Вологда, ул. Герцена, д. 2'
    },
    'Воронежская область': {
        'name': 'Арбитражный суд Воронежской области',
        'address': '394000, г. Воронеж, ул. Плехановская, д. 10'
    },
    'Ивановская область': {
        'name': 'Арбитражный суд Ивановской области',
        'address': '153000, г. Иваново, ул. Батурина, д. 5'
    },
    'Иркутская область': {
        'name': 'Арбитражный суд Иркутской области',
        'address': '664000, г. Иркутск, ул. Ленина, д. 1'
    },
    'Калининградская область': {
        'name': 'Арбитражный суд Калининградской области',
        'address': '236000, г. Калининград, ул. Дмитрия Донского, д. 1'
    },
    'Калужская область': {
        'name': 'Арбитражный суд Калужской области',
        'address': '248000, г. Калуга, ул. Ленина, д. 74'
    },
    'Кемеровская область': {
        'name': 'Арбитражный суд Кемеровской области',
        'address': '650000, г. Кемерово, ул. Весенняя, д. 23'
    },
    'Кировская область': {
        'name': 'Арбитражный суд Кировской области',
        'address': '610000, г. Киров, ул. Ленина, д. 80'
    },
    'Костромская область': {
        'name': 'Арбитражный суд Костромской области',
        'address': '156000, г. Кострома, ул. Советская, д. 1'
    },
    'Курганская область': {
        'name': 'Арбитражный суд Курганской области',
        'address': '640000, г. Курган, ул. Гоголя, д. 56'
    },
    'Курская область': {
        'name': 'Арбитражный суд Курской области',
        'address': '305000, г. Курск, ул. Ленина, д. 15'
    },
    'Ленинградская область': {
        'name': 'Арбитражный суд Ленинградской области',
        'address': '191124, г. Санкт-Петербург, ул. Смольного, д. 6'
    },
    'Липецкая область': {
        'name': 'Арбитражный суд Липецкой области',
        'address': '398000, г. Липецк, ул. Зегеля, д. 8'
    },
    'Магаданская область': {
        'name': 'Арбитражный суд Магаданской области',
        'address': '685000, г. Магадан, ул. Портовая, д. 16'
    },
    'Московская область': {
        'name': 'Арбитражный суд Московской области',
        'address': '143400, г. Красногорск, ул. Речная, д. 7'
    },
    'Мурманская область': {
        'name': 'Арбитражный суд Мурманской области',
        'address': '183000, г. Мурманск, ул. Ленина, д. 82'
    },
    'Нижегородская область': {
        'name': 'Арбитражный суд Нижегородской области',
        'address': '603000, г. Нижний Новгород, ул. Варварская, д. 6'
    },
    'Новгородская область': {
        'name': 'Арбитражный суд Новгородской области',
        'address': '173000, г. Великий Новгород, ул. Большая Московская, д. 88'
    },
    'Новосибирская область': {
        'name': 'Арбитражный суд Новосибирской области',
        'address': '630099, г. Новосибирск, ул. Советская, д. 5'
    },
    'Омская область': {
        'name': 'Арбитражный суд Омской области',
        'address': '644000, г. Омск, ул. Ленина, д. 1'
    },
    'Оренбургская область': {
        'name': 'Арбитражный суд Оренбургской области',
        'address': '460000, г. Оренбург, ул. Советская, д. 17'
    },
    'Орловская область': {
        'name': 'Арбитражный суд Орловской области',
        'address': '302000, г. Орел, ул. Ленина, д. 17'
    },
    'Пензенская область': {
        'name': 'Арбитражный суд Пензенской области',
        'address': '440000, г. Пенза, ул. Московская, д. 86'
    },
    'Псковская область': {
        'name': 'Арбитражный суд Псковской области',
        'address': '180000, г. Псков, ул. Некрасова, д. 23'
    },
    'Ростовская область': {
        'name': 'Арбитражный суд Ростовской области',
        'address': '344000, г. Ростов-на-Дону, ул. Социалистическая, д. 62'
    },
    'Рязанская область': {
        'name': 'Арбитражный суд Рязанской области',
        'address': '390000, г. Рязань, ул. Ленина, д. 30'
    },
    'Самарская область': {
        'name': 'Арбитражный суд Самарской области',
        'address': '443000, г. Самара, ул. Куйбышева, д. 60'
    },
    'Саратовская область': {
        'name': 'Арбитражный суд Саратовской области',
        'address': '410000, г. Саратов, ул. Московская, д. 72'
    },
    'Сахалинская область': {
        'name': 'Арбитражный суд Сахалинской области',
        'address': '693000, г. Южно-Сахалинск, ул. Ленина, д. 219'
    },
    'Свердловская область': {
        'name': 'Арбитражный суд Свердловской области',
        'address': '620075, г. Екатеринбург, ул. Шарташская, д. 4'
    },
    'Смоленская область': {
        'name': 'Арбитражный суд Смоленской области',
        'address': '214000, г. Смоленск, ул. Ленина, д. 4'
    },
    'Тамбовская область': {
        'name': 'Арбитражный суд Тамбовской области',
        'address': '392000, г. Тамбов, ул. Советская, д. 118'
    },
    'Тверская область': {
        'name': 'Арбитражный суд Тверской области',
        'address': '170000, г. Тверь, ул. Советская, д. 23'
    },
    'Томская область': {
        'name': 'Арбитражный суд Томской области',
        'address': '634000, г. Томск, ул. Ленина, д. 30'
    },
    'Тульская область': {
        'name': 'Арбитражный суд Тульской области',
        'address': '300000, г. Тула, ул. Ленина, д. 2'
    },
    'Тюменская область': {
        'name': 'Арбитражный суд Тюменской области',
        'address': '625000, г. Тюмень, ул. Республики, д. 72'
    },
    'Ульяновская область': {
        'name': 'Арбитражный суд Ульяновской области',
        'address': '432000, г. Ульяновск, ул. Гончарова, д. 13'
    },
    'Челябинская область': {
        'name': 'Арбитражный суд Челябинской области',
        'address': '454091, г. Челябинск, ул. Воровского, д. 2'
    },
    'Ярославская область': {
        'name': 'Арбитражный суд Ярославской области',
        'address': '150000, г. Ярославль, ул. Республиканская, д. 42'
    },
    'Еврейская автономная область': {
        'name': 'Арбитражный суд Еврейской автономной области',
        'address': '679000, г. Биробиджан, ул. Ленина, д. 25'
    },
    'Ненецкий автономный округ': {
        'name': 'Арбитражный суд Ненецкого автономного округа',
        'address': '166000, г. Нарьян-Мар, ул. Ленина, д. 2'
    },
    'Ханты-Мансийский автономный округ': {
        'name': 'Арбитражный суд Ханты-Мансийского автономного округа - Югры',
        'address': '628000, г. Ханты-Мансийск, ул. Мира, д. 40'
    },
    'Чукотский автономный округ': {
        'name': 'Арбитражный суд Чукотского автономного округа',
        'address': '689000, г. Анадырь, ул. Ленина, д. 23'
    },
    'Ямало-Ненецкий автономный округ': {
        'name': 'Арбитражный суд Ямало-Ненецкого автономного округа',
        'address': '629000, г. Салехард, ул. Республики, д. 72'
    }
}

# Паттерны для парсинга
PARSING_PATTERNS = {
    'entity': {
        'inn': r'ИНН[:\s]*(\d{10}|\d{12})',
        'kpp': r'КПП[:\s]*(\d{9})',
        'ogrn': r'ОГРН[:\s]*(\d{13}|\d{15})',
        'address': r'адрес[:\s]*(.+?)(?=\n|ИНН|КПП|ОГРН|$)',
    },
    'financial': {
        'debt': [
            r'долг[а]?\s*[:\-]?\s*(\d[\d\s,]*\.?\d*)',
            r'сумм[аы]\s*[:\-]?\s*(\d[\d\s,]*\.?\d*)',
            r'задолженност[ьи]\s*[:\-]?\s*(\d[\d\s,]*\.?\d*)'
        ],
        'contract': r'договор[а]?\s*№?\s*([A-Za-zА-Яа-я0-9\-_/]+)',
        'invoice': r'счет[а]?\s*№?\s*([A-Za-zА-Яа-я0-9\-_/]+)',
        'upd': r'упд\s*№?\s*([A-Za-zА-Яа-я0-9\-_/]+)',
    },
    'dates': {
        'date': r'(\d{2}[\.\/]\d{2}[\.\/]\d{4})',
        'postal': r'№\s*(\d+)[^\d]{0,40}?об отправке и получении[^\d]{0,40}?(\d{2}\.\d{2}\.\d{4})'
    }
}

# Сообщения об ошибках
ERROR_MESSAGES = {
    'file_not_found': 'Файл не найден',
    'invalid_format': 'Поддерживаются только файлы .docx',
    'file_too_large': 'Размер файла превышает {max_size}MB',
    'empty_file': 'Файл пустой',
    'no_content': 'Документ не содержит текста или таблиц',
    'parsing_error': 'Ошибка чтения документа: {error}',
    'validation_error': 'Ошибки в данных: {errors}',
    'network_error': 'Ошибка сети при получении данных',
    'calculation_error': 'Ошибка расчета: {error}'
}

# Сообщения для пользователя
USER_MESSAGES = {
    'welcome': 'Добро пожаловать в IskBot! Загрузите документ .docx для начала работы.',
    'file_uploaded': '✅ Файл "{filename}" успешно загружен и проверен.\nРазмер: {size:.1f} KB\nТеперь ответьте на несколько вопросов для формирования иска.',
    'processing': '⏳ Обрабатываю документ...',
    'success': '✅ Исковое заявление успешно сформировано!',
    'error': '❌ Ошибка: {message}',
    'help': 'Для получения помощи обратитесь к администратору.'
}


def get_court_by_city(city: str) -> Tuple[str, str]:
    """
    Получает информацию о суде по городу.

    Args:
        city: Название города

    Returns:
        Кортеж (название суда, адрес суда)
    """
    city_lower = city.lower()

    for court_city, court_info in COURTS_DATABASE.items():
        if city_lower in court_city.lower() or court_city.lower() in city_lower:
            return court_info['name'], court_info['address']

    # Если город не найден, возвращаем общий суд
    return (
        "Арбитражный суд по месту нахождения ответчика",
        "Адрес суда не определен"
    )


def validate_config() -> List[str]:
    """
    Валидирует конфигурацию.

    Returns:
        Список ошибок конфигурации
    """
    errors = []

    # Проверяем обязательные директории
    if not os.path.exists(BOT_CONFIG['temp_dir']):
        try:
            os.makedirs(BOT_CONFIG['temp_dir'], exist_ok=True)
        except Exception as e:
            errors.append(
                f"Не удалось создать директорию {BOT_CONFIG['temp_dir']}: {e}")

    # Проверяем настройки
    if BOT_CONFIG['max_file_size_mb'] <= 0:
        errors.append("max_file_size_mb должно быть больше нуля")

    if not BOT_CONFIG['supported_formats']:
        errors.append("Должен быть указан хотя бы один поддерживаемый формат")

    return errors
